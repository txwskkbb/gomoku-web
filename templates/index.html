<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>五子棋 - Web AI</title>
    <style>
        canvas { border: 1px solid black; }
    </style>
</head>
<body>
    <h2>五子棋 - 玩家 vs AI</h2>
    <canvas id="board" width="600" height="600"></canvas>
    <button onclick="startNewGame()">重开游戏</button>

    <script>
        const canvas = document.getElementById("board");
        const ctx = canvas.getContext("2d");
        const size = 20;
        const cellSize = canvas.width / size;

        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < size; i++) {
                ctx.beginPath();
                ctx.moveTo(cellSize / 2, cellSize / 2 + i * cellSize);
                ctx.lineTo(canvas.width - cellSize / 2, cellSize / 2 + i * cellSize);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(cellSize / 2 + i * cellSize, cellSize / 2);
                ctx.lineTo(cellSize / 2 + i * cellSize, canvas.height - cellSize / 2);
                ctx.stroke();
            }
        }

        function drawStone(row, col, player) {
            ctx.beginPath();
            const x = col * cellSize + cellSize / 2;
            const y = row * cellSize + cellSize / 2;
            ctx.arc(x, y, 10, 0, 2 * Math.PI);
            ctx.fillStyle = player === 1 ? "black" : "white";
            ctx.fill();
        }

        canvas.addEventListener("click", async function(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const col = Math.floor(x / cellSize);
            const row = Math.floor(y / cellSize);

            const res = await fetch("/player_move", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ row: row, col: col })
            });
            const data = await res.json();
            if (data.status === "ok") {
                drawStone(row, col, 1);
                if (data.ai_move) {
                    drawStone(data.ai_move[0], data.ai_move[1], 2);
                }
                if (data.message) {
                    alert(data.message);
                }
            } else {
                alert(data.message);
            }
        });

        async function startNewGame() {
            await fetch("/new_game", { method: "POST" });
            drawBoard();
        }

        drawBoard();
    </script>
</body>
</html>
